<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetFox - Vehicle QA Portal</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Supabase JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Top Navigation (shown when authenticated) -->
    <div id="topbar" class="topbar" style="display: none;">
        <div class="brand">fleet<span class="accent">fox</span></div>
        <nav class="navlinks">
            <a href="#" id="nav-upload" onclick="app.navigate('/upload'); return false;" style="display: none;">Upload</a>
            <a href="#" onclick="app.navigate('/dashboard'); return false;">Dashboard</a>
            <a href="#" onclick="handleLogout(); return false;">Logout</a>
        </nav>
    </div>

    <!-- Main App Content -->
    <div id="app-content"></div>

    <!-- Scripts (load in order) -->
    <!-- Load configuration (reads from /api/config or uses defaults) -->
    <script src="js/config.js"></script>
    <!-- Then load Supabase client -->
    <script src="js/supabase.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/onboarding.js"></script>
    <script src="js/qa-upload.js"></script>
    <script src="js/dashboard-helpers.js"></script>
    <script src="js/app.js"></script>

    <script>
        // Handle logout
        async function handleLogout() {
            await auth.signOut();
            app.navigate('/login');
        }

        // Show/hide topbar and nav items based on auth state and role
        auth.onAuthStateChange(async (event, user) => {
            const topbar = document.getElementById('topbar');
            if (user && topbar) {
                topbar.style.display = 'flex';
                
                // Show/hide nav items based on role
                const role = await auth.getUserRole() || 'fox';
                const uploadLink = document.getElementById('nav-upload');
                if (uploadLink) {
                    uploadLink.style.display = role === 'fox' ? 'block' : 'none';
                }
            } else if (topbar) {
                topbar.style.display = 'none';
            }
        });
    </script>
</body>
</html>

